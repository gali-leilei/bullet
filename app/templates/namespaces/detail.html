{% extends "layouts/app.html" %}

{% block title %}{{ namespace.name }} - {{ app_name }}{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex items-center justify-between">
        <div>
            <p class="text-gray-600 text-sm">
                <a href="/namespaces" class="text-blue-600 hover:underline">å‘½åç©ºé—´</a> /
            </p>
            <h1>{{ namespace.name }}</h1>
            <p class="text-gray-500 mt-1">{{ namespace.description or 'æ— æè¿°' }}</p>
        </div>
        <div class="flex gap-2">
            <a href="/namespaces/{{ namespace.id }}/edit" class="btn-secondary">ç¼–è¾‘</a>
            <a href="/namespaces/{{ namespace.id }}/projects/new" class="btn-primary">æ–°å»ºé¡¹ç›®</a>
        </div>
    </div>
</div>

<div class="card mb-6">
    <div class="card-header">
        <h2>é¡¹ç›®åˆ—è¡¨</h2>
    </div>
    {% if projects %}
    <table class="table">
        <thead>
            <tr>
                <th>é¡¹ç›®åç§°</th>
                <th>çŠ¶æ€</th>
                <th>å‡çº§ç­–ç•¥</th>
                <th>é€šçŸ¥ç»„</th>
                <th>Webhook URL</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
            <tr>
                <td class="font-medium">
                    <a href="/namespaces/{{ namespace.id }}/projects/{{ project.id }}" class="text-blue-600 hover:underline">
                        {{ project.name }}
                    </a>
                </td>
                <td>
                    {% if project.is_silenced() %}
                    <span class="badge badge-orange">ğŸ”‡ é™é»˜</span>
                    {% elif project.is_active %}
                    <span class="badge badge-green">å¯ç”¨</span>
                    {% else %}
                    <span class="badge badge-gray">ç¦ç”¨</span>
                    {% endif %}
                </td>
                <td>
                    {% if project.escalation_config.enabled %}
                    <span class="text-sm">{{ project.escalation_config.timeout_minutes }}åˆ†é’Ÿ</span>
                    {% else %}
                    <span class="text-gray-400">ç¦ç”¨</span>
                    {% endif %}
                </td>
                <td>{{ project_group_counts.get(project.id|string, 0) }}</td>
                <td x-data="{ copied: false }">
                    <div class="flex items-center gap-1">
                        <code class="text-xs bg-gray-100 px-1 truncate max-w-32" title="{{ base_url }}/webhook/{{ namespace.slug }}/{{ project.id }}">.../{{ namespace.slug }}/{{ project.id }}</code>
                        <button type="button" 
                                @click="navigator.clipboard.writeText('{{ base_url }}/webhook/{{ namespace.slug }}/{{ project.id }}'); copied = true; setTimeout(() => copied = false, 1500)"
                                class="text-gray-400 hover:text-gray-600 p-0.5"
                                :title="copied ? 'å·²å¤åˆ¶' : 'å¤åˆ¶'">
                            <svg x-show="!copied" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            <svg x-show="copied" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                        </button>
                    </div>
                </td>
                <td>
                    <a href="/namespaces/{{ namespace.id }}/projects/{{ project.id }}" class="text-blue-600 hover:underline mr-2">æŸ¥çœ‹</a>
                    <form method="POST" action="/namespaces/{{ namespace.id }}/projects/{{ project.id }}/delete" class="inline" onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤æ­¤é¡¹ç›®å—ï¼Ÿ')">
                        <button type="submit" class="text-red-600 hover:underline">åˆ é™¤</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-gray-500 text-sm p-4">æš‚æ— é¡¹ç›®ï¼Œ<a href="/namespaces/{{ namespace.id }}/projects/new" class="text-blue-600 hover:underline">åˆ›å»ºç¬¬ä¸€ä¸ªé¡¹ç›®</a></p>
    {% endif %}
</div>
{% endblock %}
